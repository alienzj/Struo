rule braken_build:
    """
    Build braken database from kraken2 database
    """
    input:
        kraken2_db = kraken2_dir + 'hash.k2d'
    output:
        kraken2_dir + 'database{read_len}mers.kraken',
        kraken2_dir + 'database{read_len}mers.kmer_distrib'
    params:
        kmer = config['params']['bracken_build_kmer'],
        exe = config['pipeline']['script_folder'] + 'bracken-build.py',
        read_len = lambda wildcards: wildcards.read_len,
    threads:
        24
    resources:
        time = lambda wildcards, attempt: attempt ** 2 * 59,
        mem_gb_pt = lambda wildcards, attempt: attempt ** 2
    conda:
        '../envs/kraken2.yaml'
    log:
        log_dir + 'bracken_build/ReadLen{read_len}.log'
    benchmark:
        benchmark_dir + 'bracken_build/ReadLen{read_len}.txt'
    shell:
        """
        DB=`dirname {input.kraken2_db}`

        {params.exe} -t {threads} -d $DB \
          -k {params.kmer} -l {params.read_len} \
          2>&1 > {log}
        """

